# DondeLasPapasQueman - Project Overview

## Introduction

**DondeLasPapasQueman** (Where the Potatoes Burn) is a BoardGame Arena (BGA) game implementation. This project follows the BGA Studio framework structure, which separates game logic (PHP backend) from user interface (JavaScript frontend).

## Project Structure

### Root Directory Files

#### Configuration Files
- **`gameinfos.inc.php`** - Contains game metadata and configuration:
  - Game name, publisher information
  - Player count configuration (2-4 players)
  - Estimated game duration
  - Player colors
  - Game interface dimensions
  - Language dependencies

- **`gameoptions.json`** - Game options configuration (currently empty, ready for customization)

- **`gamepreferences.json`** - User preferences configuration (currently empty, ready for customization)

- **`stats.json`** - Game statistics definitions (currently empty, ready for customization)

- **`package.json`** - Node.js dependencies and build scripts:
  - Uses Rollup and Sass for TypeScript/SCSS compilation (official BGA setup)
  - Build and watch scripts for development

#### Database
- **`dbmodel.sql`** - Database schema definition:
  - Defines custom tables for the game
  - Currently contains example templates for card tables
  - Extends the standard BGA tables (global, stats, gamelog, player)

#### Frontend Files
- **`modules/js/Game.js`** - Compiled JavaScript file (auto-generated from TypeScript source)
  - Main entry point for the game UI
  - Uses modern BGA framework with `Bga` interface
  - Built using Rollup from `modules/src/dondelaspapasqueman.ts`

- **`dondelaspapasqueman.css`** - Compiled stylesheet (auto-generated from SCSS)
  - Compiled from `modules/src/dondelaspapasqueman.scss`
  - Defines layout, sprites, and visual styling
  - Contains CSS sprite examples for game assets

#### Development Files
- **`_ide_helper.php`** - IDE autocomplete helper for PHP development
- **`bga-framework.d.ts`** - TypeScript definitions for BGA framework
- **`LICENCE_BGA`** - BGA license information
- **`README.md`** - Development setup instructions

### Modules Directory (`/modules`)

The modules directory contains the source code organized by language and purpose.

#### PHP Backend (`/modules/php`)

**`Game.php`** - Main game logic class:
- Extends `Bga\GameFramework\Table`
- Initializes game state and global variables
- Manages player counters (e.g., energy counter)
- Defines card types and game constants
- Handles game setup (`setupNewGame`)
- Provides game data to frontend (`getAllDatas`)
- Contains debug functions for testing
- Manages game progression calculation

**`States/`** - Game state machine classes:
- **`PlayerTurn.php`** - Active player turn state:
  - Handles player actions (play card, pass)
  - Validates player moves
  - Manages notifications to all players
  - Updates scores and game state
  - Contains zombie player handling (for disconnected players)
  
- **`NextPlayer.php`** - Transition state between turns:
  - Manages turn progression
  - Gives extra time to players
  - Determines next game state (PlayerTurn or EndScore)
  - Updates game progression
  
- **`EndScore.php`** - End game state:
  - Final scoring calculations
  - Transitions to game end state (ST_END_GAME)

#### JavaScript Frontend (`/modules/js`)

**`Game.js`** - Compiled client-side game interface (auto-generated):
- This file is automatically generated from TypeScript source
- Do not edit this file directly - edit `modules/src/dondelaspapasqueman.ts` instead
- Main UI controller class using modern BGA framework
- Initializes game interface on page load
- Sets up player boards and counters
- Handles state transitions (`onEnteringState`, `onLeavingState`)
- Manages action buttons (`onUpdateActionButtons`)
- Handles player interactions (e.g., card clicks)
- Sets up notification listeners for real-time updates

#### Source Directory (`/modules/src`)
- **`dondelaspapasqueman.ts`** - TypeScript source file (edit this, not Game.js)
- **`dondelaspapasqueman.scss`** - SCSS stylesheet source
- **`dondelaspapasqueman.d.ts`** - TypeScript type definitions for game data

### Other Directories

- **`img/`** - Game images and assets
- **`misc/`** - Miscellaneous files
- **`node_modules/`** - Node.js dependencies

## Game Flow

1. **Game Initialization** (`Game.php::setupNewGame`)
   - Creates players in database
   - Initializes player counters (energy starts at 2)
   - Sets up initial game state
   - Activates first player

2. **Player Turn** (`PlayerTurn.php`)
   - Active player can:
     - Play a card (gains 1 point)
     - Pass (gains 1 energy)
   - Actions are validated
   - Notifications sent to all players
   - Transitions to `NextPlayer` state

3. **Turn Transition** (`NextPlayer.php`)
   - Gives extra time to active player
   - Activates next player
   - Checks for game end conditions
   - Returns to `PlayerTurn` or goes to `EndScore`

4. **Game End** (`EndScore.php`)
   - Final scoring
   - Transitions to end game state

## Key Features

### Player Counters
- **Energy Counter**: Tracks player energy (initialized at 2, increases when passing)

### Card System
- Card types defined in `Game.php::$CARD_TYPES`
- Example cards: Troll, Goblin
- Cards have IDs and names (translatable)

### State Management
- Uses BGA's state machine pattern
- States are PHP classes that extend `GameState`
- Each state has specific responsibilities

### Notifications
- Real-time updates to all players
- Supports internationalization (i18n)
- Notification decorators can auto-complete player/card names

### Zombie Mode
- Handles disconnected players
- `PlayerTurn.php::zombie()` method makes random valid moves
- Ensures game can continue if a player leaves

## Development Workflow

1. **Setup**: Follow instructions in `README.md`
   - Configure devcontainer
   - Download project via SFTP
   - Run build task (watches for changes)

2. **Backend Development** (PHP):
   - Edit files in `/modules/php/`
   - Game logic in `Game.php`
   - State logic in `States/` directory

3. **Frontend Development** (TypeScript):
   - Edit TypeScript source in `/modules/src/dondelaspapasqueman.ts`
   - Edit SCSS styles in `/modules/src/dondelaspapasqueman.scss`
   - Do NOT edit `modules/js/Game.js` directly - it's auto-generated

4. **Build Process**:
   - TypeScript files are compiled to `modules/js/Game.js` using Rollup
   - SCSS files are compiled to `dondelaspapasqueman.css` using Sass
   - Run `npm run build` for one-time build or `npm run watch` for auto-rebuild

## BGA Framework Integration

This project uses the modern BGA framework with:
- **PHP 8+** with strict types
- **Namespaced classes** (`Bga\Games\DondeLasPapasQueman`)
- **Type-safe state management**
- **Component-based architecture** (counters, notifications, etc.)
- **Promise-based notifications** in JavaScript

## Current Implementation Status

The project appears to be in early development with:
- ✅ Basic game structure and state machine
- ✅ Player counter system (energy)
- ✅ Example card play and pass actions
- ✅ Basic UI setup with player boards
- ⚠️ Card types defined but not fully implemented
- ⚠️ Database schema needs to be defined for game-specific data
- ⚠️ Statistics and game options need configuration
- ⚠️ Full game rules need implementation

## Next Steps for Development

1. Define complete database schema in `dbmodel.sql`
2. Implement full card system and game mechanics
3. Complete UI implementation in `Game.js`
4. Add game statistics in `stats.json`
5. Configure game options in `gameoptions.json`
6. Add comprehensive styling in CSS
7. Implement all game state transitions
8. Add proper game end conditions and scoring

## Resources

- [BGA Studio Documentation](http://en.boardgamearena.com/#!doc/Studio)
- [BGA Game Interface Logic](http://en.doc.boardgamearena.com/Game_interface_logic:_yourgamename.js)
- [BGA Using TypeScript and SCSS](https://en.doc.boardgamearena.com/Using_Typescript_and_Scss)
